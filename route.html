<!DOCTYPE html>
<html lang="en">
<head>
  <title>WifiWay</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <link rel="stylesheet" type="text/css" href="css/style.css">
</head>
<body>

<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>                        
      </button>
      <a class="navbar-brand" href="#" id="back">WifiWay</a>
    </div>
    <div class="collapse navbar-collapse" id="myNavbar">
      <ul class="nav navbar-nav">
        <li class="active"><a href="#">Home</a></li>
        <li><a href="#">About</a></li>
        <li><a href="#">Projects</a></li>
        <li><a href="#">Contact</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="#"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
      </ul>
    </div>
  </div>
</nav>
  <div class="container-fluid">
    <div class="row">
      <div class="col-sm-6 "><input type="text" class="form-control" id="usr" placeholder="Seleccionar origen"></div>
      <div class="col-sm-6 "><input type="text" class="form-control" id="usr" placeholder="Seleccionar destino"></div>
    </div>
  </div>

<div class="container-fluid text-center">    
  <div class="row content">
    <div class="col-sm-12 text-left maps" id="mapDiv"> 
      <div id="floating-panel">
      <b>Start: </b>
      <select id="start">
        <option value="chicago, il">Chicago</option>
        <option value="st louis, mo">St Louis</option>
        <option value="joplin, mo">Joplin, MO</option>
        <option value="oklahoma city, ok">Oklahoma City</option>
        <option value="amarillo, tx">Amarillo</option>
        <option value="gallup, nm">Gallup, NM</option>
        <option value="flagstaff, az">Flagstaff, AZ</option>
        <option value="winona, az">Winona</option>
        <option value="kingman, az">Kingman</option>
        <option value="barstow, ca">Barstow</option>
        <option value="san bernardino, ca">San Bernardino</option>
        <option value="los angeles, ca">Los Angeles</option>
      </select>
      <b>End: </b>
      <select id="end">
        <option value="chicago, il">Chicago</option>
        <option value="st louis, mo">St Louis</option>
        <option value="joplin, mo">Joplin, MO</option>
        <option value="oklahoma city, ok">Oklahoma City</option>
        <option value="amarillo, tx">Amarillo</option>
        <option value="gallup, nm">Gallup, NM</option>
        <option value="flagstaff, az">Flagstaff, AZ</option>
        <option value="winona, az">Winona</option>
        <option value="kingman, az">Kingman</option>
        <option value="barstow, ca">Barstow</option>
        <option value="san bernardino, ca">San Bernardino</option>
        <option value="los angeles, ca">Los Angeles</option>
      </select>
    </div>
      <div id="map"></div>
      <script>
        var mapDiv = $('#mapDiv');
        var map;
        var previusMarker;
        var directionsService;
        var directionsDisplay;
        $(document).ready(function(){ 
          $('#back').click(function(){
            mapDiv.removeClass('col-sm-10').addClass('col-sm-12');
            $("#panelOculto").toggle(100);
            previusMarker.setMap(null);
            map.setZoom(4);
            document.getElementById("usr").value = "";
          });
        });

        function initMap() {
          var myLatlng = {lat: 40.400144, lng: -3.722540};

          directionsService = new google.maps.DirectionsService;
          directionsDisplay = new google.maps.DirectionsRenderer;
          map = new google.maps.Map(document.getElementById('map'), {
            zoom: 4,
            center: myLatlng
          });

          directionsDisplay.setMap(map);

          var onChangeHandler = function() {
            calculateAndDisplayRoute(directionsService, directionsDisplay);
          };

          map.addListener('click', function(event) {
            if(mapDiv.hasClass('col-sm-12')){
              mapDiv.removeClass('col-sm-12').addClass('col-sm-10');
              $("#panelOculto").toggle(100);
            } 
            //else {
            //  mapDiv.removeClass('col-sm-10').addClass('col-sm-12');
            //}
            //$("#panelOculto").toggle(100);

            map.setZoom(17);
            //map.setCenter(marker.getPosition());
            addMarker(event.latLng);
          });

          document.getElementById('start').addEventListener('change', onChangeHandler);
          document.getElementById('end').addEventListener('change', onChangeHandler);

        }

        // Adds a marker to the map and push to the array.
        function addMarker(location) {
          if (previusMarker != null) {
            previusMarker.setMap(null);
          }
          var marker = new google.maps.Marker({
            position: location,
            map: map
          });
          previusMarker = marker;
          map.setCenter(marker.getPosition());
          document.getElementById("usr").value = marker.getPosition().lat() + ", " +  marker.getPosition().lng();
          console.log(marker.getPosition().lat());
          console.log(marker.getPosition().lng());
        }

        function calculateAndDisplayRoute(directionsService, directionsDisplay) {
          directionsService.route({
            origin: document.getElementById('start').value,
            destination: document.getElementById('end').value,
            travelMode: 'DRIVING'
          }, function(response, status) {
            if (status === 'OK') {
              directionsDisplay.setDirections(response);
              var stepsArray = response.routes[0].legs[0].steps;
              var i;
              console.log(stepsArray);
              for(i=0; i<stepsArray.length; i++){
                var lat_origen = stepsArray[i].start_location.lat();
                var lng_origen = stepsArray[i].start_location.lng();

                var lat_dest = stepsArray[i].end_location.lat();
                var lng_dest = stepsArray[i].end_location.lng();

                var paths = stepsArray[i].path;
                //console.log(paths);
                for (var j=0; j<paths.length; j++) {
                  var lat_path = paths[j].lat();
                  var lng_path = paths[j].lng();
                  console.log("Punto: " + lat_path + ", " + lng_path);
                }
                //console.log("Origen: " + lat_origen + ", " + lng_origen)
                //console.log("Destino: " + lat_dest + ", " + lng_dest)
              }
            } else {
              window.alert('Directions request failed due to ' + status);
            }
          });
        }

      </script>
      <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBDlUUPKEKse9Bj_Mtq2sPoLC6BFePtl2U&callback=initMap">
      </script>
    </div>
    <div class="col-sm-2 sidenav" id="panelOculto" style="display: none;">
      <div class="well">
        <p>ADS</p>
      </div>
      <div class="well">
        <p>ADS</p>
      </div>
    </div>
  </div>
</div>
<div class="container-fluid ads">    
  <div class="row">
    <div class="col-sm-4">
      <div class="well">
        <p>ADS</p>
      </div>
    </div>
    <div class="col-sm-4">
      <div class="well">
        <p>ADS</p>
      </div>
    </div>
    <div class="col-sm-4">
      <div class="well">
        <p>ADS</p>
      </div>
    </div>
  </div>
</div>

<footer class="container-fluid text-center">
  <p>Footer Text</p>
</footer>

</body>
</html>
